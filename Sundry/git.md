# 用一个场景说明 Git 的基本使用

你一个程序员要是说自己不会用 Git ，那真是要快去学一学啦，不然怎么和其他程序员小伙伴合( Gao )作( Ji )啊。最近用 Git 用的比较多，也看了不少帖子，但是奈何 Git 指令太复杂，对于我这种小白来说真的是记不住啊，总是需要反复的查几个指令的用法，所以干脆把一些常用的指令和这些指令的使用场景记录下来，以备不时之需。

## 1. Git 仓库的克隆

小加入我们在 Github 上发现了一个项目 `ProjectA` ，很感兴趣，同时想为这个项目添加一些功能。那么首先我们就需要将这个项目的仓库克隆到本地，这样才能获得项目代码并对项目代码进行修改。这个时候首先需要 Fork 这个项目到自己的 GitHub 账户下，这个时候自己的账户下就会多出一个相同的 `ProjectA` 项目。

然后将这个项目从自己的仓库下克隆下来：

	git clone git@github.com:iNARI777/ProjectA

这个仓库就被克隆到自己的机器上，就可以对其进行修改了。 `git clone` 会将远程的历史都克隆下来，但是分支只有当前选择的那一个。

## 2. Git 的存储结构和状态

Git 有几个概念需要明确：

1. 工作区（ Working directory ）：就是我们的电脑里 Git 仓库的目录，我们对文件进行的所有修改都是对**工作区**的修改。
2. 版本库（ Repository ）：每一个 Git 分支都有一个版本库，这个版本库中保存了这个分支对 Git 仓库内容进行的所有修改。

存储结构大致如下图所示。版本库中又有一个暂存区（ Stage ）以及当前分支上一次提交之后的内容。我们通常在工作区中对文件进行修改之后，这个版本库不会立刻更改，需要我们进行提交。而 Git 的存储结构决定了我们需要进行两次提交。

![借个图哈哈](images/git/0.jpg)

每当对仓库下的文件进行修改后，这些**工作区**文件就被标识为已修改。在任何时候我们都可以查看当前**工作区**和**暂存区**的内容是否干净：

	git status

如果当前**工作区**或者**暂存区**有未提交的修改，都可以通过这个指令进行查询。

## 3. 提交修改

如果想将这些修改提交，那么就需要先将**工作区**的修改加入**暂存区**：

	git add <修改的文件>

然后将**暂存区**中的修改提交到我们的分支上：

	git commit -m "<提交说明>"

这个时候我们的修改就正式写入了我们当前的分支。我们可以查看当前分支的修改记录：

	git log

可以显示出提交的哈希码（代表版本号）、提交人、提交时间以及提交时的说明。如果我们只想看版本号可以给上面命令加上 `--oneline` 选项。

## 4. 如果你后悔了

假如你的修改出现了错误，不用担心，还是有快速挽回的方法的。

**假如你想取消之前的 add 操作：**

这个时候我们是想取消之前的 add 操作，让所有修改回到工作区：

	git reset HEAD --<想取消 add 的文件的文件名>

这个指令不会影响工作区的内容，仅仅是取消了之前的 add 操作。这里的 `HEAD` 指的就是当前分支当前仓库版本的指针。

> 是因为没有加 `--hard` 选项哦

**假如你将工作区的内容改乱了，想将工作区恢复到上次提交后的状态：**

可以使用下面的命令对**整个工作区**进行复原：
	
	git reset --hard HEAD

将**工作区**中的所有修改都复原，也就是说你做的修改都没有啦！因此对于没有提交的修改来说，带有 `--hard` 选项的 `git reset` 操作一定要**慎用！慎用！慎用！**

如果你只想还原**一个文件**可以使用：

	git checkout --<文件名>

同样要慎用啊！

**如果你想恢复到之前的某一个版本：**

同样适用 `reset` 命令：

	git reset --hard <版本号的前几位>

版本号的前几位可以通过 `git log` 进行查询。注意版本号是可以为 `HEAD` 的，代表当前版本。

**如果你 commit 之后的文件有错误：**

有两种方法都可以对其进行修改：

1. 继续修改，修改完之后再 `add` 和 `commit` ，这种做法一般是正确的，你可以在已经发布的分支上继续进行正常的提交。
2. 撤销提交，这有可能导致分支历史的改变，一般不建议使用，因为如果你已经把这次的提交上传到了远程分支，如果你撤销提交再进行新的提交会导致**本地分支**和**远程分支**产生冲突，使得之后的本地分支无法进行正常的提交。

使用如下指令可以撤销一个提交：

	git revert <版本号>

> `revert` 和 `reset` 都可以撤销提交，但是两者的原理不同，`revert` 是通过一个与 `commit` 完全相反的修改并对这次修改进行 `commit` 的过程，而 `reset` 仅仅是将当前版本指向一个之前的版本。总的来说，`revert` 会产生一个新的提交，而 `reset` 不会。

## 5. 分支的管理

**分支**和**历史**是 Git 的两个重要功能。上面我们主要讲了**历史**，那么下面就介绍一下**分支**的功能。

**分支的查看：**

我们可以通过如下指令看到所有的本地分支，前面带星号“*”的就是我们当前所处的分支。

	git branch

我们还可以给上面的指令加上 `-a` 选项，这样还可以看到所有的远程分支。一般是 `remotes/origin/<远程分支名>`。

**分支的创建及跳转：**

我们可以通过 `git branch <分支名>` 新建一个分支，也可以通过如下指令新建并转移到一个分支：

	git checkout -b <分支名>

我们可以通过下面的指令跳转到一个已经存在的分支：

	git checkout <分支名>

**分支的合并：**

我们创建分支的目的说到底是要协同开发，所以我们就不能只是各自在各自的分支上开发，几个人开发到一定程度会将几个分支的修改进行合并：

	git merge <分支名>

这样就可以把`<分支名>`指代的分支合并到当前分支上，而这个过程中可能会出现冲突，这个时候通过：

	git status

查看是那些文件发生了冲突，并对这些文件进行修改，修改完成后进行 `git add` 和 `git commit`就完成了这次的合并。

如果想放弃合并，就使用：
	
	git merge --abort

当然也可以使用 `rebase` 来进行合并。

## 其他参考

[1] [git-merge完全解析](https://www.jianshu.com/p/58a166f24c81)

[2] [一个成功的Git分支模型](https://www.jianshu.com/p/b357df6794e3)

[3] [git merge 和 git rebase 小结](https://blog.csdn.net/wh_19910525/article/details/7554489)