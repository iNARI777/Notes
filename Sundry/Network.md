# 计算机网络的知识点

### 1. NAT——网络地址转换

由于IPv4地址资源紧张，人们提出了NAT作为IPv4协议的补丁，将私网地址与合法公网地址进行了映射，确保了在符合IP协议一致性的基础上，扩展了IPv4地址的数量。虽然代理服务器可以作为NAT设备，但是考虑到成本问题，大多数NAT设备的任务是由路由器来完成。

有三种网络地址转换的方式：

* 静态转换，将内部地址**一对一**地映射到公网，并且是不变的。
* 动态转换，在将私有地址转换为共有地址的时候，是**随机的**，**动态分配的**。这种转换方式适用于拥有的IP地址数量少于内部私有地址数量的时候。
* 端口多路复用，内部计算机可以使用同一个公网IP地址进行通信，且对外出数据包的**源端口**进行转换。这样可以最大限度的节约IP地址资源，且能够保证网络内部计算机的安全。这种方式是当前使用最多的方式。

> 这里可以涉及到另一个知识点——**五元组**，对于一个连接，一个五元组可以唯一地标识这个连接，它们是(TCP, 源地址, 源端口, 目的地址, 目的端口)，只要其中一个不同，就可以标识不同的连接。

有一种进行内网穿透的方法，就是需要一个外部有公网IP的服务器，两个不同内网的主机想要相互通信，两个主机A和B分别向服务器进行注册，服务器可以分别保存两台主机端口映射后的地址，分别发送给A和B两个主机，这样就可以正常进行通信了。

### 2. OAuth认证过程

具体过程见[这里](https://www.barretlee.com/blog/2016/01/10/oauth2-introduce/)和[这里](https://www.zhihu.com/question/19781476)以及[这里](https://blog.csdn.net/seccloud/article/details/8192707)。

### 3. ICMP协议

ICMP主要有两大类型报文，一种是**查询报文**，一种是**差错报文**。在对差错报文进行响应的时候永远不会产生另一个差错报文，否则就有可能有循环产生差错报文的情况发生。

ICMP报头如下图所示，结构很简单。

![](images/network/1.jpg)

查询报文和差错报文中还有很多种具体类型的报文。报文的具体类型由ICMP报文报头中的8位类型和8位代码共同决定。（各种类型见《TCP/IP详解（卷1）》P51）

ICMP还有一个规则是：ICMP差错报文必须包括生成该差错报文的IP数据包的首部以及首部后的前8个字节（这8个字节通常包含TCP或UDP的首部的源和目的端口号）。

ICMP的常见用途：

* 时间戳请求、应答：从其他主机上获得时间
* 网络/主机/协议/端口不可达：目的不可达（共16种ICMP不可达差错，这四种较常见）
* 重定向差错：网络、主机等重定向，用于路由表更新
* 请求回显：Ping程序
* 路由器发现：路由器通告与请求
